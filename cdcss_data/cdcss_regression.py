import csv
import numpy as np
from sklearn.linear_model import LinearRegression

# Canadian Government Dataset Class, used to store data from the Canadian Government Dataset
class dataSet:
    def __init__(self, province, sex, age_group, year, rate, Rate_95_CI_Lower, Rate_95_CI_Upper,Rate_CV,Counts,Population):
        self.province = province if len(province) > 0 else None
        self.sex = sex if len(sex) > 0 else None
        self.age_group = age_group.strip('\'') if len(age_group) > 0 else None
        self.year = int(year) if len(year) > 0 else None
        self.rate = float(rate) if len(rate) > 0 else None
        self.Rate_95_CI_Lower = float(Rate_95_CI_Lower) if len(rate) > 0 else None
        self.Rate_95_CI_Upper = float(Rate_95_CI_Upper) if len(rate) > 0 else None
        self.Rate_CV = float(Rate_CV) if len(rate) > 0 else None
        self.Counts = float(Counts) if len(rate) > 0 else None
        self.Population = int(Population) if len(rate) > 0 else None
    
    def __repr__(self) -> str:
        return f'Rate (per 100,000): {self.rate}, Rate 95% CI Lower: {self.Rate_95_CI_Lower}, Rate 95% CI Upper: {self.Rate_95_CI_Upper}, Rate CV: {self.Rate_CV}, Counts: {self.Counts}, Population: {self.Population}'

def parseFile(file):
  # Parse the csv file with the proper categories
  provinces = {
      'Canada': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Newfoundland and Labrador': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Prince Edward Island': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Nova Scotia': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'New Brunswick': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Quebec': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Ontario': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Manitoba': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Saskatchewan': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Alberta': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'British Columbia': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Yukon Territory': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      },
      'Nunavut': {
          'Both sexes': {
                  '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Males': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                },
                'Females': {
                      '1+':{}, '1-4':{}, '5-9':{}, '1-19':{}, '10+' : {}, '16+':{}, '20+':{},
                  '10-19':{},
                  '10-14':{},
                  '15-19':{}, '16-19':{}, '16-34':{},
                  '20-34':{}, '35+':{},
                  '20-24':{},
                  '25-29':{},
                  '30-34':{},
                  '35-49':{},
                  '35-39':{},
                  '40-44':{}
                  ,'40+': {}, '40-49':{},
                  '45-49':{},
                  '50-64':{},
                  '50-54':{},
                  '55-59':{},
                  '60-64':{}, '65+': {},
                  '65-79':{},
                  '65-69':{},
                  '70-74':{},
                  '75-79':{},
                  '80+':{},
                  '80-84':{},
                  '85-89':{},
                  '90+':{}
                }
      }
  }
  with open(file) as csvfile:
      reader = csv.reader(csvfile)
      for row in reader:
          if len(row) == 0:
              break
          else:
              if row[0] in provinces:
                  provinceData = dataSet(row[0], row[1], row[2], row[3], row[4], row[5], row[6], row[7], row[8], row[9])
                  provinces[row[0]][row[1]][row[2].strip('\'')][row[3]] = provinceData
  
  return provinces

def cleanPopulationCSV():
      # only run this if parsing the population data is necessary
      fields = ['Province', 'Sex', 'Age Group', 'Population']
      population = []
      with open('cdcss_data/csv/population.csv') as csvfile:
        reader = csv.reader(csvfile)
        for row in reader:
            if 'to' in row[4]:
              population.append([row[1], row[3], row[4].replace(' to ', '-').replace(' years', ''), row[-5]])
            elif 'All ages' in row[4]:
              population.append([row[1], row[3], row[4].replace('All ages', '0+'), row[-5]])
      
      with open('cdcss_data/csv/population_clean.csv', 'w') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(fields)
        writer.writerows(population)

def populationCalculator(userData):
    province = userData[0]
    sex = userData[1]
    age = userData[2]
    ageRanges = []
    indexes = []

    with open('cdcss_data/csv/population_clean.csv') as csvfile:
        reader = csv.reader(csvfile)
        for row in reader:
            if row[0] == province and row[1] == sex:
                if '+' in age:
                  if row[2][:2] == age[:2]:
                    # or (age[:2] == "1+" and row[2][:2] == "0+")
                    indexes.append(len(ageRanges))
                
                  if row[2][-2:] == "99" or row[2][-2:] == "90+":
                     indexes.append(len(ageRanges))

                  ageRanges.append([row[2], row[3]])
                  
                else:
                  if row[2] == age:
                      return row[3]
                  else:
                    if row[2][:2] == age[:2]:
                      indexes.append(len(ageRanges))
                    # elif row[2][:2] == '0-' and age[:2] == "1-":
                    #    indexes.append(len(ageRanges))
                    if row[2][-2:] == age[-2:]:
                      indexes.append(len(ageRanges))
                    ageRanges.append([row[2], row[3]])
        print(age)
        totalPop = 0
        for x in range(indexes[0], indexes[1]+1):
          totalPop += int(ageRanges[x][1])
        
        return totalPop

def regressionModel(provinces, userData):
  province = userData[0]
  sex = userData[1]
  age = userData[2]
  demographic = provinces[province][sex][age]

  total_x = []
  total_y = []
  for year in demographic:
      data_x = demographic[year].Population
      data_y = demographic[year].Counts

      if data_x is not None and data_y is not None:
        total_x.append(data_x)
        total_y.append(data_y)

      if len(total_x) == 0 or len(total_y) == 0:
        return [0, 0, 0]

      genius_regression_model = LinearRegression()
      genius_regression_model.fit(np.array(total_x).reshape(-1, 1),total_y)
      population_2023 = int(populationCalculator(userData))
      numCount = int(abs(genius_regression_model.predict(np.array(population_2023).reshape(1,-1))))
      rate_per_100k = int((numCount/population_2023)*100_000)

      return [population_2023, numCount, rate_per_100k]
  
def writeDiseaseInfo(groupData, disease):
    with open(disease, 'w') as csvfile:
      headers = ['Population', 'Count', 'Rate (per 100,000)', 'Province', 'Sex', 'Age Group']
      writer = csv.writer(csvfile)
      writer.writerow(headers)
      writer.writerows(groupData)



def main():
    parsedData = parseFile('FILENAME')
    groupData = []

    for province in parsedData:
       if province != "Canada":
        for sex in parsedData[province]:
            for age in parsedData[province][sex]:
              if (age[-1] != "+") and len(parsedData[province][sex][age]) > 0:
                  print(age)
                  regression = regressionModel(parsedData, [province, sex, age]) + [province, sex, age]
                  groupData.append(regression)

    groupData.sort(key=lambda x: x[2])

    for age in parsedData['Canada']['Both sexes']:
       if "+" in age and age == "40+":
          regression = regressionModel(parsedData, ['Canada', 'Both sexes', age]) + ['Canada', 'Both sexes', age]
          break
    
    groupData.insert(0, regression)

    # get one by one from stats canada
    writeDiseaseInfo(groupData, 'FILNAME')
       

main()